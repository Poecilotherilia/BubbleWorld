---
--- Generated by lvyuqiang
--- File name : story_chapter_item.lua.txt
--- DateTime : 2023/03/09
--- Description : 剧情章节
---

local super = observable
local message = message
local msg_types = enum.message_type
local guide_trigger_type = enum.guide.guide_trigger_type
local experience_play_type = enum.experience.experience_play_type

---@class story_chapter_item
local story_chapter_item = class("story_chapter_item", super)

---构造函数
---@private
function story_chapter_item:ctor()
    super.ctor(self)

    ---章节Id
    ---@type string
    self.chapter_id = nil

    ---是否主线
    ---@type boolean
    self.is_main_story = false

    ---章节名称
    ---@type string
    self.chapter_name = nil
    self:create_simple_property("chapter_name", nil, true)

    ---章节进度
    ---@type number
    self.chapter_progress = 0
    self:create_simple_property("chapter_progress", 0, true)

    ---文本化章节进度
    ---@type string
    self.chapter_progress_string = nil
    self:create_simple_property("chapter_progress_string", nil, true)

    ---章节解锁进度
    ---@type number
    self.chapter_unlock_progress = 0
    self:create_simple_property("chapter_unlock_progress", 0, true)

    ---文本化章节解锁进度
    ---@type number
    self.chapter_unlock_progress_string = 0
    self:create_simple_property("chapter_unlock_progress_string", 0, true)

    ---章节描述
    ---@type string
    self.chapter_desc = nil
    self:create_simple_property("chapter_desc", nil, true)

    ---章节解锁条件
    ---@type string
    self.chapter_unlock_condition = nil
    self:create_simple_property("chapter_unlock_condition", nil, true)

    ---章节是否解锁
    ---@type boolean
    self.is_chapter_unlock = false
    self:create_simple_property("is_chapter_unlock", false, true)

    ---章节解锁特效是否可见
    ---@type boolean
    self.is_chapter_unlock_tip_visible = nil
    self:create_simple_property("is_chapter_unlock_tip_visible", false, true)

    ---章节描述或章节解锁条件
    ---@type string
    self.chapter_desc_or_unlock_condition = nil
    self:create_simple_property("chapter_desc_or_unlock_condition", nil, true)

    ---（已解锁）章节进度或（未解锁时）解锁所需的条件进度
    ---@type string
    self.chapter_progress_or_unlock_progress_string = nil
    self:create_simple_property("chapter_progress_or_unlock_progress_string", nil, true)

    ---章节奖励
    ---@type table<reward_item>
    self.chapter_rewards = nil
    self:create_simple_property("chapter_rewards", nil, true)
end

function story_chapter_item:on_click()
    --探索系统点击检测
    if not system_manager.explore:explore_is_can_btn() then
        return
    end
    
    message.broadcast(msg_types.SHOW_STORY_CHAPTER_INFO, self)
end

function story_chapter_item:on_close_click()
    message.broadcast(msg_types.HIDE_STORY_CHAPTER_INFO)
end

function story_chapter_item:on_goto_btn_click()
    local story = system_manager.story
    if self.is_main_story then
        ---开始主线剧情
        story:start_main_story()
    else
        ---开始支线剧情
        story:start_branch_story(self.chapter_id)
    end
    message.broadcast(msg_types.STORY_START_STORY)
    message.broadcast(msg_types.GUIDE_TRY_TRIGGER, guide_trigger_type.click_story_battle_panel)
end

return story_chapter_item