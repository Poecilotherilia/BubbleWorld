---
--- Generated by wuhaijun
--- File name : callback.lua.txt
--- DateTime : 2021/03/29
--- Description : 
---

local table_remove = table.remove

---@class callback
local callback = {}
callback.__index = callback

callback.__tostring = function(t)
    return t.cname .. '[size=' .. tostring(t.size) .. ']'
end

---New
---@public
---@param action function
---@param observer table
function callback.new(action, observer)
    local instance =
    {
        cname = "callback",
        action_list = {},
        data_dict = {},
        size = 0,
    }
    setmetatable(instance, callback)
    if action ~= nil then
        instance:add(action, observer)
    end
    return instance
end

callback.__call = function(t, ...)
    local action_list = t.action_list
    local data_dict = t.data_dict

    for i = 1, #action_list do
        local action = action_list[i]
        local inst = data_dict[action]

        if inst == true then
            action(...)
        else
            action(inst, ...)
        end
    end
end

---添加
---@public
---@param action function
---@param instance table self
function callback:add(action, instance)
    if action == nil then
        return false
    end

    if self.data_dict[action] == nil then
        self.data_dict[action] = instance or true
        self.size = self.size + 1
        self.action_list[self.size] = action
        return true
    else
        return false
    end
end

---移除
---@public
---@param action function
function callback:remove(action)
    if self.data_dict[action] == nil then return end

    self.data_dict[action] = nil
    for i = 1, self.size do
        if self.action_list[i] == action then
            table_remove(self.action_list, i)
            break
        end
    end
    self.size = self.size - 1
end

---是否包含对象
---@public
---@param action function
function callback:contains(action)
    return self.data_dict[action] ~= nil
end

---数量
---@public
---@return number
function callback:count()
    return self.size
end

---清理
---@public
function callback:clear()
    for i = 1, self.size do
        self.action_list[i] = nil
    end
    for key, _ in pairs(self.data_dict) do
        self.data_dict[key] = nil
    end
    self.size = 0
end

---销毁
---@public
function callback:dispose()
    self:clear()

    self.action_list = nil
    self.data_dict = nil
    self.size = nil
end

return callback