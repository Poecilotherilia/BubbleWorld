---
--- Generated by wuhaijun
--- File name : system_battle_render_effect_remove.lua.txt
--- DateTime : 2022/03/09
--- Description : 
---

---@type battle_helper
local helper = battle_helper

---@type battle_components
local battle_components = require(helper.path.battle_components)
---@type matchers
local matchers = require(helper.path.ecs .. 'matchers')
---@type reactive_system
local super = require(helper.path.ecs .. 'reactive_system')

---@class system_battle_render_effect_remove : reactive_system
local system_battle_render_effect_remove = class("system_battle_render_effect_remove", super)

---构造函数
---@protected
---@param context context
function system_battle_render_effect_remove:ctor(context)
    super.ctor(self, context)
end

---获取触发配置
---@protected
---@param context context
---@return collector
function system_battle_render_effect_remove:get_trigger(context)
    return context:get_collector(matchers.all(battle_components.remove_effect))
end

---过滤
---@protected
---@param entity entity
---@return boolean
function system_battle_render_effect_remove:filter(entity)
    return entity:has_component(battle_components.remove_effect)
end

---组件变化时执行
---@protected
---@param entity_list entity[]
---@param count number
function system_battle_render_effect_remove:executes(entity_list, count)
    for i = 1, count do
        local entity = entity_list[i]

        ---@type queue string特效表ID队列
        local effect_queue = entity:get_component(battle_components.remove_effect).value

        -- 移除特效
        local target_eid = entity.eid
        while not effect_queue:is_empty() do
            local render_unit = self.context.renderer:get_render_unit(target_eid)
            if render_unit ~= nil then
                render_unit:remove_effect_handle(effect_queue:dequeue())
            end
        end
    end
end

return system_battle_render_effect_remove