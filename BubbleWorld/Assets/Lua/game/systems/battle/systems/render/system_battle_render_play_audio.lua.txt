---
--- Generated by wuhaijun
--- File name : system_battle_render_play_audio.lua.txt
--- DateTime : 2023/07/05
--- Description : 
---

---@type battle_helper
local helper = battle_helper

---@type battle_components
local battle_components = require(helper.path.battle_components)
---@type matchers
local matchers = require(helper.path.ecs .. 'matchers')
---@type reactive_system
local super = require(helper.path.ecs .. 'reactive_system')

---@class system_battle_render_play_audio : reactive_system
local system_battle_render_play_audio = class("system_battle_render_play_audio", super)

---构造函数
---@protected
---@param context context
function system_battle_render_play_audio:ctor(context)
    super.ctor(self, context)
end

---初始化
---@protected
function system_battle_render_play_audio:initialize()
end

---获取触发配置
---@protected
---@param context context
---@return collector
function system_battle_render_play_audio:get_trigger(context)
    return context:get_collector(matchers.all(battle_components.play_audio))
end

---过滤
---@protected
---@param entity entity
---@return boolean
function system_battle_render_play_audio:filter(entity)
    return entity:has_component(battle_components.play_audio)
end

---组件变化时执行
---@protected
---@param list entity[] 实体列表
---@param count number 列表长度
function system_battle_render_play_audio:executes(list, count)
    for i = 1, count do
        local entity = list[i]
        local comp = entity:get_component(battle_components.play_audio)
        if comp ~= nil then
            self:on_play_audio_handle(comp.value, entity.eid)
        end
    end
end

---播放音效处理
---@private
---@param audio_mid string
---@param eid number
function system_battle_render_play_audio:on_play_audio_handle(audio_mid, eid)
    local render = self.context.renderer:get_render_unit(eid)
    if render ~= nil then
        render:play_sound(audio_mid)
    end
end

return system_battle_render_play_audio