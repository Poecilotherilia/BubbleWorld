---
--- Generated by wuhaijun
--- File name : system_battle_render_replace.lua.txt
--- DateTime : 2022/03/16
--- Description : 替换渲染层
---

---@type battle_helper
local helper = battle_helper
local table_names = tables

---@type state_utility
local state_utility = require(helper.path.battle_fsm .. 'state_utility')
---@type battle_components
local battle_components = require(helper.path.battle_components)
---@type matchers
local matchers = require(helper.path.ecs .. 'matchers')

---@type reactive_system
local super = require(helper.path.ecs .. 'reactive_system')

---@class system_battle_render_replace : reactive_system
local system_battle_render_replace = class("system_battle_render_replace", super)

---构造函数
---@protected
---@param context context
function system_battle_render_replace:ctor(context)
    super.ctor(self, context)
end

---获取触发配置
---@protected
---@param context context
---@return collector
function system_battle_render_replace:get_trigger(context)
    return context:get_collector(matchers.all(battle_components.replace_render))
end

---过滤
---@protected
---@param entity entity
---@return boolean
function system_battle_render_replace:filter(entity)
    return entity:has_component(battle_components.replace_render)
end

---组件变化时执行
---@protected
---@param entity_list entity[]
---@param count number
function system_battle_render_replace:executes(entity_list, count)
    for i = 1, count do
        local entity = entity_list[i]
        ---@type { res_path:string, render_script:string }
        local replace_comp = entity:get_component(battle_components.replace_render)
        entity:replace_component(battle_components.asset_data, replace_comp.res_path, replace_comp.render_script)
    end
end

return system_battle_render_replace