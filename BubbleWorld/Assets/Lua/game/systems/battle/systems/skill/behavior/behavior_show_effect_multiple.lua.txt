---
--- Generated by wuhaijun
--- File name : behavior_show_effect_multiple.lua.txt
--- DateTime : 2022/07/05
--- Description : 播放多个特效
---

---@type battle_helper
local helper = battle_helper
local behavior_class_name = enum.battle.behavior_class_name

---@type base_behavior
local super = require(helper.path.battle_skill .. 'behavior/base_behavior')

---@class behavior_show_effect_multiple : base_behavior
local behavior_show_effect_multiple = class("behavior_show_effect_multiple", super)

---构造函数
---@protected
function behavior_show_effect_multiple:ctor()
    super.ctor(self, self.cname)
end

---行为开始，根据配置延迟后开始
---@protected
function behavior_show_effect_multiple:on_start()
    ---@type show_effect_multiple_data
    local data = self.behavior_data.behavior_args.ShowEffectMultipleData
    self:log_assert(data ~= nil, "invalid ShowEffectMultipleData")

    ---@type number 特效持续时间
    local duration<const> = 0
    local class_name<const> = behavior_class_name.SHOW_EFFECT
    
    for i = 1, #data.DataList do
        local effect_data = data.DataList[i]

        ---@type number 开始延迟时间
        local delay = effect_data.StartTime
        
        ---@type entity[] 目标实体列表
        local entity_list = self:get_behavior_targets(effect_data.TargetId)
        for j = 1, #entity_list do
            local entity = entity_list[j]
            
            ---@type skill_behavior_config_args
            local config_args = self.context:get_free_table("behavior_show_effect_multiple.config_args")
            config_args.ShowEffectData = effect_data
            
            self:generate_behavior(delay, duration, class_name, config_args, entity.eid)
        end
    end
end

return behavior_show_effect_multiple