---
--- Generated by wuhaijun
--- File name : behavior_move_to_target.lua.txt
--- DateTime : 2022/02/25
--- Description : 
---

---@type battle_helper
local helper = battle_helper
local is_nil_or_empty = string.is_nil_or_empty
---@type enum_battle
local enum_battle = enum.battle
local behavior_class_name = enum_battle.behavior_class_name

---@type battle_components
local battle_components = require(helper.path.battle_components)
---@type base_behavior
local super = require(helper.path.battle_skill .. 'behavior/base_behavior')

---@class behavior_move_to_target : base_behavior
local behavior_move_to_target = class("behavior_move_to_target", super)

---构造函数
---@protected
function behavior_move_to_target:ctor()
    super.ctor(self, self.cname)
end

---行为开始，根据配置延迟后开始
---@protected
function behavior_move_to_target:on_start()
    ---@type move_to_target_data
    local data = self.behavior_data.behavior_args.MoveToTargetData
    self:log_assert(data ~= nil, "invalid MoveToTargetData")

    self:play_animation_handle(data.ActionData, data.duration_time)
    self:unit_move_to_position(data.StartMoveTime, data.EndMoveTime, data.MovePosData)
    self:unit_move_to_position(data.StartBackTime, data.EndBackTime, data.GoBackData)
end

---播放动作
---@private
---@param action_data show_action_data 播放动作数据
function behavior_move_to_target:play_animation_handle(action_data)
    local delay_time<const> = 0
    local duration_time<const> = self.behavior_data.duration_time
    local class_name = behavior_class_name.SHOW_ACTION

    ---@type skill_behavior_config_args
    local config_args = self.context:get_free_table("behavior_move_to_target.show_action")
    config_args.ShowActionData = action_data

    self:generate_behavior(delay_time, duration_time, class_name, config_args, self:get_current_eid())
end

---单位移动向位置
---@private
---@param delay_time number
---@param duration_time number
---@param pos_data move_to_position_data
function behavior_move_to_target:unit_move_to_position(delay_time, duration_time, pos_data)
    local class_name = behavior_class_name.MOVE_TO_POSITION
    local execute_eid = self:get_current_eid()

    ---@type skill_behavior_config_args
    local config_args = self.context:get_free_table("behavior_move_to_target.unit_move_to_postion")
    config_args.MoveToPositionData = pos_data

    self:generate_behavior(delay_time, duration_time, class_name, config_args, execute_eid)
end

---销毁行为
---@protected
function behavior_move_to_target:on_dispose()
    self.trigger_camera_event_callback = nil
end

return behavior_move_to_target