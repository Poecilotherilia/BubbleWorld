---
--- Generated by wuhaijun
--- File name : behavior_visual_control.lua.txt
--- DateTime : 2022/07/06
--- Description : 视觉控制行为
---

---@type battle_helper
local helper = battle_helper
local behavior_class_name = enum.battle.behavior_class_name

---@type base_behavior
local super = require(helper.path.battle_skill .. 'behavior/base_behavior')

---@class behavior_visual_control : base_behavior
local behavior_visual_control = class("behavior_visual_control", super)

---构造函数
---@protected
function behavior_visual_control:ctor()
    super.ctor(self, self.cname)
end

---行为开始，根据配置延迟后开始
---@protected
function behavior_visual_control:on_start()
    ---@type visual_control_multiple_data
    local data = self.behavior_data.behavior_args.VisualControlMultipleData
    self:log_assert(data ~= nil, "invalid VisualControlMultipleData")

    local class_name<const> = behavior_class_name.LOOK_AT_TARGET

    for i = 1, #data.DataList do
        ---@type look_at_target_data
        local look_at_data = data.DataList[i]

        ---@type number 延迟开始时间
        local delay = look_at_data.StartTime
        ---@type number 转身结束时间
        local end_time = look_at_data.EndTime

        if end_time - delay > 0 then
            ---@type entity[] 目标实体列表
            local entity_list = self:get_behavior_targets(look_at_data.ExecuteUnitType)
            for j = 1, #entity_list do
                local entity = entity_list[j]
            
                ---@type skill_behavior_config_args
                local config_args = self.context:get_free_table("behavior_visual_control.config_args")
                config_args.LookAtTargetData = look_at_data
            
                self:generate_behavior(delay, end_time, class_name, config_args, entity.eid)
            end
        end
    end
end

---销毁行为
---@protected
function behavior_visual_control:on_dispose()
end

return behavior_visual_control