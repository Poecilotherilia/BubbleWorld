---
--- Generated by wuhaijun
--- File name : curve_utility.lua.txt
--- DateTime : 2022/04/26
--- Description : 曲线工具
---

---@class curve_utility
local curve_utility = {}

---获取曲线上时间点的值
---@public
---@param keys animation_curve_keyframe[] 关键帧数组，数组长度必须 >= 2
---@param time number 时间值[0 ~ 1]
---@return number
function curve_utility.animation_curve_evaluate(keys, time)
    if keys == nil then return time end
    
    local key_count = #keys
    if key_count < 2 then return time end
    
    local index = 2
    for i = 1, key_count do
        if keys[i].Time > time then
            index = i
            break
        end
    end
    
    local keyframe0 = keys[index]
    local keyframe1 = keys[index - 1]

    local dt = keyframe1.Time - keyframe0.Time

    local m0 = keyframe0.OutTangent * dt
    local m1 = keyframe1.InTangent * dt

    local t = (time - keyframe0.Time) / dt

    local t2 = t * t
    local t3 = t2 * t

    local a = 2 * t3 - 3 * t2 + 1
    local b = t3 - 2 * t2 + t
    local c = t3 - t2
    local d = -2 * t3 + 3 * t2

    local value = a * keyframe0.Value + b * m0 + c * m1 + d * keyframe1.Value
    
    return value
end

return curve_utility