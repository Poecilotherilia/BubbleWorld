---
--- Generated by wuhaijun
--- File name : cubic_bezier_curve.lua.txt
--- DateTime : 2022/08/29
--- Description : 立方贝塞尔
---

local super = require 'game/systems/battle/utils/curve/multi_segment_path_ctrl'

---@class cubic_bezier_curve : multi_segment_path_ctrl
local cubic_bezier_curve = { cname = 'bezier_curve' }
setmetatable(cubic_bezier_curve, { __index = super })

---@public
---@return cubic_bezier_curve
---@param path_data skill_path_data
function cubic_bezier_curve.new(path_data)
    ---@type cubic_bezier_curve
    local instance = setmetatable({}, { __index = cubic_bezier_curve })
    instance:ctor(path_data)
    return instance
end

---计算路径点
---@public
---@param t number 时间值[0 ~ 1]
---@param start_position skill_pos_info 开始位置
---@param end_position skill_pos_info 结束位置
---@param start_tangent skill_pos_info 开始切线位置
---@param end_tangent skill_pos_info 结束切线位置
---@return number, number, number
function cubic_bezier_curve:calculate_path_point(t, start_position, end_position, start_tangent, end_tangent)
    local u = 1 - t
    local t2 = t * t
    local u2 = u * u
    local u3 = u2 * u
    local t3 = t2 * t
    
    local r0_x = u3 * start_position.X
    local r0_y = u3 * start_position.Y
    local r0_z = u3 * start_position.Z
    
    local r1 = 3 * u2 * t
    local r1_x = r1 * start_tangent.X
    local r1_y = r1 * start_tangent.Y
    local r1_z = r1 * start_tangent.Z

    local r2 = 3 * u * t2
    local r2_x = r2 * end_tangent.X
    local r2_y = r2 * end_tangent.Y
    local r2_z = r2 * end_tangent.Z
    
    local r3_x = t3 * end_position.X
    local r3_y = t3 * end_position.Y
    local r3_z = t3 * end_position.Z
    
    local r_x = r0_x + r1_x + r2_x + r3_x
    local r_y = r0_y + r1_y + r2_y + r3_y
    local r_z = r0_z + r1_z + r2_z + r3_z

    return r_x, r_y, r_z
end

return cubic_bezier_curve