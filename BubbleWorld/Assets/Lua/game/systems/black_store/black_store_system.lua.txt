---
--- Generated by bbhuang
--- File name : black_store_system.lua.txt
--- DateTime : 2023/02/06
--- Description : 黑市商人系统
---

local black_store_controller = require 'game/systems/black_store/black_store_controller'
local message = message
---@type message_type
local message_type = enum.message_type
local data = data
local tables = tables
local camera_manager = camera_manager
local enum_common = enum.common
local camera_layer = enum_common.camera_layer
local camera_blend_type = enum_common.camera_blend_type


---@class black_store_system
local black_store_system = class("black_store_system")

---构造函数
---@protected
function black_store_system:ctor()
    
end

---进入黑市
---@public
function black_store_system:enter_black_store()
    --1. 隐藏UI隐藏场景中的英雄
    message.broadcast(message_type.COLLEGE_CONTROL_HERO_SHOW_HIDDEN, false)
    window.set_enable(false)

    if not game_data_manager.player:check_system_function_open(tables.SystemFunction.ids.SystemFunction_BlackMarket) then
        return
    end
    
    --2. 播放动画，语音，推进相机
    self.ctrl:play_enter_anim(function()
        --3. 显示黑市UI
        window.set_enable(true)
        message.broadcast(message_type.BLACK_STORE_ENTER)
    end)
end

---退出黑市
---@public
function black_store_system:exit_black_store()
    if not game_data_manager.player:check_system_function_open(tables.SystemFunction.ids.SystemFunction_BlackMarket) then
        return
    end
    --1 隐藏黑市UI，退回相机，显示主角模型
    window.set_enable(false)
    
    ---3 播放退出动画
    self.ctrl:play_exit_anim(function()
        ---4 显示其他UI
        window.set_enable(true)
        message.broadcast(message_type.BLACK_STORE_EXIT)
        self.ctrl:play_idle_anim()
        self.ctrl:remove_virtual_camera()

        ---2 显示场景中的英雄
        message.broadcast(message_type.COLLEGE_CONTROL_HERO_SHOW_HIDDEN, true)
    end)
end

---零点刷新商品退出黑市
---@public
function black_store_system:exit_black_store_simple(type)
    self.ctrl:remove_virtual_camera()
    self.ctrl:play_idle_anim()

    message.broadcast(message_type.COLLEGE_CONTROL_HERO_SHOW_HIDDEN, true)
    
    if type == 1 then
        return
    end
    
    message.broadcast(message_type.BLACK_STORE_EXIT)
end

---初始化模型
---@public
function black_store_system:init_model()
    ---@type black_store_controller
    self.ctrl = black_store_controller.new()
    self.ctrl:init_model()
end

---清楚模型
---@public
function black_store_system:destroy_model()
    if self.ctrl then
        self.ctrl:dispose()
    end
    self.ctrl = nil
end

---destroy
---@public
function black_store_system:dispose()
    if self.ctrl then
        self.ctrl:dispose()
    end
end

return black_store_system